################################
### CONFIGURACIÓN GENERAL ###
################################

# Prefijo - cambiar de Ctrl-b a Ctrl-a 
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Recargar configuración con prefix + r
bind r source-file ~/.tmux.conf \; display-message "Config recargada!"

# Habilitar mouse
set -g mouse on

# Empezar índices en 1 (más intuitivo)
set -g base-index 1
setw -g pane-base-index 1

# Renumerar ventanas automáticamente
set -g renumber-windows on

# Historial más largo
set -g history-limit 10000

# Sin delay para escape (importante para Vim)
set -sg escape-time 0

# Habilitar 256 colores y true color
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc,kitty:Tc"

# Habilitar focus events (importante para Vim)
set -g focus-events on

# Actualizar título de terminal
set -g set-titles on
set -g set-titles-string '#S ● #I:#W'

# Posición de la barra de estado
set -g status-position top

################################
### NAVEGACIÓN Y VENTANAS ###
################################

# Split horizontal y vertical (más intuitivo)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind \\ split-window -h -c "#{pane_current_path}"  # alternativa
bind _ split-window -v -c "#{pane_current_path}"   # alternativa

# Navegación estilo Vim entre panes
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Redimensionar panes con Vim keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Alternar entre panes
bind Tab last-pane
bind Space next-layout

# Navegación entre ventanas
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+
bind -r n next-window
bind -r p previous-window

# Crear nueva ventana en el directorio actual
bind c new-window -c "#{pane_current_path}"

# Matar pane/ventana sin confirmación
bind x kill-pane
bind X kill-window

# Alternar zoom
bind z resize-pane -Z

# Sincronizar panes (útil para comandos en múltiples servidores)
bind S setw synchronize-panes \; display-message "Sincronización #{?pane_synchronized,ON,OFF}"

################################
### MODO COPIA (Vi-style) ###
################################

# Usar vi keys en modo copia
setw -g mode-keys vi

# Entrar en modo copia con prefix + [
bind Escape copy-mode

# Copiar al portapapeles del sistema
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "wl-copy"
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "wl-copy"
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "wl-copy"

# Pegar desde el portapapeles
bind p run "wl-paste -n | tmux load-buffer - ; tmux paste-buffer"

################################
### SESIONES ###
################################

# Cambio rápido entre sesiones
bind C-s choose-session
bind s switch-client -l  # última sesión

# Crear nueva sesión
bind N new-session

################################
###         PLUGINS          ###
################################

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'dracula/tmux'

# Configuración de vim-tmux-navigator
# Smart pane switching con integración Neovim
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind-key -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind-key -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind-key -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"

# Configuración de tmux-yank
set -g @yank_selection 'clipboard'
set -g @yank_selection_mouse 'clipboard'

# Configuración de resurrect
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-nvim 'session'

# Auto-guardar cada 15 minutos
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'


### Dracula Theme configuration
set -g @dracula-plugins "cpu-usage ram-usage weather time"
set -g @dracula-show-fahrenheit false
set -g @dracula-fixed-location "Santiago,Chile"
set -g @dracula-show-flags true
set -g @dracula-time-format "%d/%m/%Y %H:%M"
set -g @dracula-show-powerline true
set -g @dracula-show-left-icon session

# Inicializar TPM (mantener al final del archivo)
run '~/.tmux/plugins/tpm/tpm'
